@page "/fetchdata"
@using Microsoft.Security.Application
@inject HttpClient Http


<div class="alert alert-light" role="alert">
  Apraksts meklētājam. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin tellus lorem, blandit vitae ipsum eget, tristique mattis metus. 
  Proin eros nulla, rhoncus vitae odio sit amet, ullamcorper ultrices ex. Cras fringilla orci quis diam suscipit, aliquam tempor lacus tincidunt. 
</div>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">

    <EditForm Model="@searchModel" OnSubmit="@OnSearch" class="d-flex mt-1">
        <InputText @bind-Value="searchModel.Query" class="form-control" type="search" placeholder="Meklēt" aria-label="Search"  />
        <button class="btn btn-success ms-1" type="submit">Meklēt</button>

    </EditForm>

    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
            <button class="btn btn-outline-secondary ms-1 mt-1" type="button" @onclick="ClearResults">Notīrīt rezultātus</button>
        </li>
        <li class="nav-item">
            <button class="btn btn-outline-secondary ms-1 mt-1" type="button" @onclick="ShowAll">Rādīt visus ierakstus</button>
        </li>
      </ul>
  </div>
</nav>

@if (virtues == null)
{
    <p><em>Ielādē...</em></p>
}
else
{
    <p>
        @filteredVirtues.Count rezultāti @(!string.IsNullOrEmpty(searchModel.Query) ? $" meklējumam {@Encoder.HtmlEncode(searchModel.Query)}\"" : "")
        @(!string.IsNullOrEmpty(searchModel.MatchedQ) && !string.Equals(searchModel.Query, searchModel.MatchedQ, StringComparison.InvariantCultureIgnoreCase)
            ?  $" ({@Encoder.HtmlEncode(searchModel.MatchedQ)})"  : "")
    </p>

    @if (filteredVirtues.Any())
    {
         <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#filtersCollapse" aria-expanded="false" aria-controls="filtersCollapse">
            Filtri
         </button>
         <div class="collapse" id="filtersCollapse">
          <div class="card card-body">
            Filtri
          </div>
        </div>

        <table class="table table-striped table-hover table-sm">
            <thead>
                <tr>
                    <th>Nosaukums</th>
                    <th>Saite</th>
                    <th>Resursa veids</th>
                    <th>Klase</th>
                    <th>Tēma</th>
                    <th>Nodarbība</th>
                    <th>Apraksts</th>
                    <th>Video garums</th>
                    <th>Resursa veidotājs</th>

                    <th>SKOLA2030 vērtības</th>
                    <th>SKOLA2030 tikumi</th>
                    <th>e-TAP vērtības</th>
                    <th>e-TAP tikumi</th>

                    <th>Komentāri</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var virtue in filteredVirtues)
            {
                <tr>
                    <td>@virtue.Name</td>
                    <td><a href="@virtue.Url" target="_blank">Saite</a></td>
                    <td>@virtue.ResourceType</td>               
                    <td>@virtue.Grade</td>
                    <td>@virtue.Topic</td>
                    <td>@virtue.Lesson</td>
                    <td>@virtue.Description</td>                 
                    <td>@virtue.VideoMinutes</td>              
                    <td>@virtue.Source</td>

                    <td>@foreach (var item in virtue.School2030Values)
                        {
                            <span class="badge rounded-pill bg-secondary ms-1">@item</span>            
                        }
                    </td>

                    <td>@foreach (var item in virtue.School2030Virtues)
                        {
                            <span class="badge rounded-pill bg-secondary ms-1">@item</span>            
                        }
                    </td>

                    <td>@foreach (var item in virtue.EtapValues)
                        {
                            <span class="badge rounded-pill bg-secondary ms-1">@item</span>            
                        }
                    </td>

                    <td>@foreach (var item in virtue.EtapVirtues)
                        {
                            <span class="badge rounded-pill bg-secondary ms-1">@item</span>            
                        }
                    </td>
                    <td>@virtue.Comments</td>
                </tr>
            }
            </tbody>
        </table>    
    }
}
